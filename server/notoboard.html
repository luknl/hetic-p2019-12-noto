<!doctype html>
<html>
  <head>
    <title>Notoboard</title>
    <style>
      .messages { list-style-type: none; }
      .room { width: 100px; height: 100px; border-radius: 50%; background-color: grey; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer;}
    </style>
  </head>
  <body>
    <ul class="messages"></ul>
    <div id="room1" class="room" onClick="join_room(this.id)">
      Room 1
    </div>
    <div id="room2" class="room" onClick="join_room(this.id)">
      Room 2
    </div>
    <h4 class="url-connection"></h4>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io()
      const messages = document.querySelector('.messages')
      let rooms = []

      document.addEventListener("DOMContentLoaded", function(event) {
        // Generate ID
        const userId = Math.floor(Math.random()*100000)

        // Inject client ID url
        document.querySelector('.url-connection').innerHTML = "website-url.com/" + userId;

        // Link user to an ID
        socket.emit('new user', userId);
      });

      // Get all previous message
      socket.on('previous messages', (messages) => {
        messages.innerHTML = messages.map((message) => `
          <li>${message}</li>
        `).join('')
      })

      // Get last message
      socket.on('chat message', (message) => {
        messages.innerHTML += `
          <li>${message}</li>
        `
      })

      // Join room
      function join_room(roomName){
        rooms.forEach(function(room){
          socket.emit('leave room', room)
        })
        socket.emit('join room', roomName)
        rooms.push(roomName)
      }
    </script>
  </body>
</html>
